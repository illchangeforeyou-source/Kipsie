INSTRUCTIONS TO FIX PERMISSIONS

1. IN routes/web.php - Add this route after line 93 (after the permissions group ends with });)

Route::get('/permissions/api/current-user-permissions', 'App\Http\Controllers\PermissionApiController@getCurrentUserPermissions')->middleware('auth.session');

2. IN resources/views/layouts/app.blade.php - Add this script before the closing </body> tag (around line 184, right after @yield('scripts')):

    <!-- Permission Enforcer System -->
    <script src="{{ asset('js/permission-enforcer.js') }}"></script>

3. IN resources/views/layouts/app.blade.php - Update the inline script around line 161 to:

    <!-- Set user level globally -->
    <script>
        window.userLevel = {{ session('level') ? session('level') : 2 }};
        window.userId = '{{ session('id') ?? '' }}';
        console.log('ðŸ”‘ User level set to:', window.userLevel);
        console.log('ðŸ‘¤ User ID:', window.userId);
    </script>

FILES CREATED:
âœ… /public/js/permission-enforcer.js - Main permission enforcement system
âœ… /app/Http/Controllers/PermissionApiController.php - API endpoint controller

WHAT THIS FIXES:
- The "undefined" error was because the permissions system existed but nothing was actually CHECKING them
- Now elements with data-permission attributes will automatically hide/show based on user permissions
- Permissions are fetched on page load and applied in real-time

HOW TO USE:
Add data-permission attribute to any HTML element you want to hide:

<button data-permission="view_medicines">View Medicines</button>
<button data-permission="create_medicine">Add Medicine</button>
<button data-permission="delete_medicine">Delete</button>

The element will automatically hide if the user doesn't have that permission.

ALTERNATIVE USAGE IN JAVASCRIPT:
// Check if user has permission
if (checkPermission('view_medicines')) {
    // Show something
}

// Or use the full enforcer object
if (permissionEnforcer.hasPermission('view_medicines')) {
    // Do something
}

// Hide element if no permission
permissionEnforcer.hideIfNoPermission('#medicines-btn', 'view_medicines');

// Show element only if has permission
permissionEnforcer.showIfHasPermission('#medicine-edit-btn', 'edit_medicine');
